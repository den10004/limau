"use client";
import Link from "next/link";
import styles from "./page.module.css";
import { ModalQuestions } from "../Modals/ModalQuestions";
import { useEffect, useState } from "react";
import { TEL, TELLINK, TG, WHATSAPP } from "@/lib/breadcrumbs";
import { Switch } from "../Switch";

export default function Footer() {
  const [callbackModal, setCallbackModal] = useState(false);
  const [topics, setTopics] = useState<any>();

  useEffect(() => {
    const cacheKey = "topics_data";
    const ttl = 1000 * 60 * 60 * 24;
    const cached = localStorage.getItem(cacheKey);
    const cachedData = cached ? JSON.parse(cached) : null;

    if (
      cachedData &&
      cachedData.lastFetched &&
      Date.now() - cachedData.lastFetched < ttl
    ) {
      setTopics(cachedData.data);
      return;
    }

    const fetchCards = async () => {
      try {
        const res = await fetch("/api/topic");
        if (!res.ok) {
          const text = await res.text();
          throw new Error(text || "Ошибка при загрузке");
        }

        const cards = await res.json();
        const topics = cards.data;

        localStorage.setItem(
          cacheKey,
          JSON.stringify({ data: topics, lastFetched: Date.now() })
        );

        setTopics(topics);
      } catch (err: any) {
        console.log(err);
      }
    };

    fetchCards();
  }, []);

  const [mounted, setMounted] = useState(false);

  useEffect(() => {
    setMounted(true);
  }, []);

  if (!mounted) return null;

  return (
    <footer className={styles.footer}>
      <div className={styles.footer__container}>
        <div className={styles.footer__left}>
          <div className={styles.footer__logo}>
            <Link className="text-h2" href="/">
              <svg
                version="1.1"
                fill="#fff"
                viewBox="0 0 1400 222"
                width="150"
                height="50"
                xmlns="http://www.w3.org/2000/svg"
              >
                <g id="g7" transform="translate(-307.62,-889.08)">
                  <path
                    d="m 546.17,889.09 c -16.34,0 -32.15,6.81 -43.37,18.69 l -112.91,119.55 h 81.1 l 76.04,-80.51 v 104.91 c 0,0 -65.32,0 -65.32,0 l -55.63,58.96 h 65.02 v 0.21 H 605.99 V 889.08 h -59.82 z"
                    id="path1"
                  />
                  <path
                    id="polygon1"
                    d="m 392.53,1110.7 55.63,-58.96 H 366.58 V 889.09 h -58.96 v 221.61 z"
                  />
                  <path
                    id="polygon2"
                    d="m 724.6,1078.69 h 4.12 74.76 v -17.01 H 728.72 V 920.93 h -20.91 v 157.76 z"
                  />
                  <path
                    id="rect2"
                    d="m 828.84003,920.92999 h 20.91 V 1078.69 h -20.91 z"
                  />
                  <path
                    id="polygon3"
                    d="M 966.23,1049.54 914.54,920.93 h -8.99 -11.27 -6.61 v 157.76 h 20.8 v -61.55 l -2.01,-66.15 51.75,127.7 h 15.82 l 51.85,-127.52 -2.01,65.97 v 61.55 h 20.8 V 920.93 h -6.5 -11.38 -8.99 z"
                  />
                  <path
                    d="m 1142.08,920.93 h -13.76 l -60.13,157.76 h 21.34 l 14.99,-41.28 h 65.98 l 15.03,41.28 h 21.45 l -60.35,-157.76 z m -31.34,99.36 26.74,-73.61 26.79,73.61 z"
                    id="path3"
                  />
                  <path
                    d="m 1316.53,1027.65 c 0,8.23 -1.52,15.02 -4.55,20.37 -3.03,5.35 -7.28,9.32 -12.73,11.92 -5.46,2.6 -11.83,3.9 -19.13,3.9 -7.3,0 -13.56,-1.3 -19.01,-3.9 -5.45,-2.6 -9.7,-6.57 -12.73,-11.92 -3.03,-5.35 -4.55,-12.14 -4.55,-20.37 V 920.92 h -20.7 v 106.73 c 0,11.85 2.51,21.71 7.53,29.58 5.02,7.88 11.85,13.78 20.48,17.72 8.63,3.94 18.29,5.9 28.98,5.9 10.69,0 19.63,-1.97 28.33,-5.9 8.7,-3.94 15.69,-9.84 20.97,-17.72 5.27,-7.87 7.91,-17.73 7.91,-29.58 V 920.92 h -20.8 z"
                    id="path4"
                  />
                  <path
                    d="m 1465.13,940.92 c -6.17,-6.46 -13.53,-11.41 -22.05,-14.84 -8.52,-3.43 -17.95,-5.15 -28.28,-5.15 h -44.64 v 157.76 h 42.69 c 10.98,0 20.86,-1.71 29.63,-5.15 8.78,-3.43 16.29,-8.36 22.54,-14.79 6.25,-6.43 11.03,-14.21 14.36,-23.35 3.32,-9.14 4.98,-19.41 4.98,-30.83 v -9.43 c 0,-11.41 -1.66,-21.69 -4.98,-30.83 -3.32,-9.14 -8.07,-16.94 -14.25,-23.4 z m -1.46,63.66 c 0,11.49 -1.9,21.51 -5.69,30.07 -3.79,8.56 -9.44,15.21 -16.96,19.94 -7.51,4.73 -16.9,7.1 -28.17,7.1 h -21.78 V 938.06 h 23.73 c 7.8,0 14.72,1.26 20.75,3.79 6.03,2.53 11.14,6.23 15.33,11.11 4.19,4.88 7.37,10.83 9.54,17.88 2.17,7.04 3.25,15.08 3.25,24.11 v 9.64 z"
                    id="path5"
                  />
                  <path
                    id="rect5"
                    d="m 1517.3,920.92999 h 20.91 V 1078.69 h -20.91 z"
                  />
                  <path
                    d="m 1693.11,963.02 c -3,-9.35 -7.3,-17.33 -12.89,-23.95 -5.6,-6.61 -12.28,-11.65 -20.05,-15.12 -7.77,-3.47 -16.45,-5.2 -26.06,-5.2 -9.61,0 -17.86,1.73 -25.63,5.2 -7.76,3.47 -14.46,8.51 -20.1,15.12 -5.63,6.61 -9.99,14.59 -13.06,23.95 -3.07,9.36 -4.61,19.96 -4.61,31.8 v 9.97 c 0,11.85 1.55,22.46 4.66,31.85 3.11,9.39 7.49,17.37 13.16,23.95 5.67,6.57 12.39,11.6 20.15,15.06 7.76,3.47 16.31,5.2 25.63,5.2 9.32,0 18.29,-1.73 26.06,-5.2 7.76,-3.47 14.43,-8.49 19.99,-15.06 5.56,-6.57 9.82,-14.55 12.79,-23.95 2.96,-9.39 4.44,-20.01 4.44,-31.85 v -9.97 c 0,-11.85 -1.5,-22.45 -4.5,-31.8 z m -16.2,41.77 c 0,9.46 -0.94,17.82 -2.82,25.08 -1.88,7.26 -4.64,13.36 -8.29,18.31 -3.65,4.95 -8.11,8.69 -13.38,11.21 -5.27,2.53 -11.31,3.79 -18.09,3.79 -6.78,0 -12.37,-1.26 -17.61,-3.79 -5.24,-2.53 -9.75,-6.27 -13.54,-11.21 -3.79,-4.95 -6.7,-11.05 -8.72,-18.31 -2.02,-7.26 -3.03,-15.62 -3.03,-25.08 V 994.6 c 0,-9.39 1.01,-17.7 3.03,-24.92 2.02,-7.22 4.89,-13.29 8.61,-18.2 3.72,-4.91 8.2,-8.63 13.44,-11.16 5.24,-2.53 11.11,-3.79 17.61,-3.79 6.5,0 12.73,1.26 18.04,3.79 5.31,2.53 9.81,6.25 13.49,11.16 3.68,4.91 6.48,10.98 8.4,18.2 1.91,7.22 2.87,15.53 2.87,24.92 v 10.19 z"
                    id="path6"
                  />
                </g>
              </svg>
            </Link>
            <Link className="text-small" href="/polytic">
              Политика конфиденциальности
            </Link>
          </div>

          <ul className="text16">
            {/*
            <li>
              <Link href="/">О компании</Link>
            </li>*/}
            {/*
            <li>
              <Link href="/">Каталог</Link>
            </li>*/}
          </ul>
        </div>

        <div className={styles.footer__center}>
          <ul className="text-small">
            {topics?.map((item: { slug: string; title: string }, i: number) => {
              return (
                <li key={i}>
                  <Link href={item.slug}>{item.title}</Link>
                </li>
              );
            })}
          </ul>
        </div>

        <div className={styles.footer__right}>
          <div>
            <ul className="text16">
              <li className="text" style={{ cursor: "pointer" }}>
                <Link href={TELLINK}>{TEL}</Link>
              </li>
              <li
                onClick={() => setCallbackModal(true)}
                style={{ cursor: "pointer" }}
              >
                Заказать обратный звонок
              </li>
              <li>
                <Link href="/contacts">Контакты</Link>
              </li>

              <ul className={styles.footer__icons}>
                <li>
                  <Link href={WHATSAPP}>
                    <svg
                      width="30"
                      height="30"
                      viewBox="0 0 18 18"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        d="M14.8747 3.09167C14.1106 2.32009 13.2005 1.70831 12.1976 1.29197C11.1947 0.875636 10.1189 0.663073 9.03301 0.666671C4.48301 0.666671 0.774675 4.375 0.774675 8.925C0.774675 10.3833 1.15801 11.8 1.87467 13.05L0.708008 17.3333L5.08301 16.1833C6.29134 16.8417 7.64967 17.1917 9.03301 17.1917C13.583 17.1917 17.2913 13.4833 17.2913 8.93334C17.2913 6.725 16.433 4.65 14.8747 3.09167ZM9.03301 15.7917C7.79967 15.7917 6.59134 15.4583 5.53301 14.8333L5.28301 14.6833L2.68301 15.3667L3.37467 12.8333L3.20801 12.575C2.52263 11.4809 2.15878 10.2161 2.15801 8.925C2.15801 5.14167 5.24134 2.05834 9.02467 2.05834C10.858 2.05834 12.583 2.775 13.8747 4.075C14.5144 4.71156 15.0213 5.46879 15.366 6.30278C15.7108 7.13677 15.8865 8.03091 15.883 8.93334C15.8997 12.7167 12.8163 15.7917 9.03301 15.7917ZM12.7997 10.6583C12.5913 10.5583 11.5747 10.0583 11.3913 9.98334C11.1997 9.91667 11.0663 9.88334 10.9247 10.0833C10.783 10.2917 10.3913 10.7583 10.2747 10.8917C10.158 11.0333 10.033 11.05 9.82467 10.9417C9.61634 10.8417 8.94967 10.6167 8.16634 9.91667C7.54967 9.36667 7.14134 8.69167 7.01634 8.48334C6.89967 8.275 6.99967 8.16667 7.10801 8.05834C7.19967 7.96667 7.31634 7.81667 7.41634 7.7C7.51634 7.58334 7.55801 7.49167 7.62467 7.35834C7.69134 7.21667 7.65801 7.1 7.60801 7C7.55801 6.9 7.14134 5.88334 6.97467 5.46667C6.80801 5.06667 6.63301 5.11667 6.50801 5.10834H6.10801C5.96634 5.10834 5.74967 5.15834 5.55801 5.36667C5.37467 5.575 4.84134 6.075 4.84134 7.09167C4.84134 8.10834 5.58301 9.09167 5.68301 9.22501C5.78301 9.36667 7.14134 11.45 9.20801 12.3417C9.69967 12.5583 10.083 12.6833 10.383 12.775C10.8747 12.9333 11.3247 12.9083 11.683 12.8583C12.083 12.8 12.908 12.3583 13.0747 11.875C13.2497 11.3917 13.2497 10.9833 13.1913 10.8917C13.133 10.8 13.008 10.7583 12.7997 10.6583Z"
                        fill="#25D366"
                      />
                    </svg>
                  </Link>
                </li>
                <li>
                  <Link href={TG}>
                    <svg
                      width="30"
                      height="30"
                      viewBox="0 0 17 18"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        d="M8.5 17.5C13.1944 17.5 17 13.6944 17 9C17 4.30558 13.1944 0.5 8.5 0.5C3.80558 0.5 0 4.30558 0 9C0 13.6944 3.80558 17.5 8.5 17.5Z"
                        fill="#2AABEE"
                      />
                      <path
                        fillRule="evenodd"
                        clipRule="evenodd"
                        d="M3.84747 8.91028C6.3254 7.83069 7.97773 7.11896 8.80448 6.77508C11.165 5.79325 11.6555 5.6227 11.9752 5.61706C12.0455 5.61583 12.2028 5.63325 12.3046 5.71589C12.3906 5.78566 12.4143 5.87992 12.4256 5.94608C12.4369 6.01223 12.451 6.16294 12.4398 6.2807C12.3119 7.62475 11.7584 10.8864 11.4768 12.3918C11.3576 13.0287 11.123 13.2423 10.8959 13.2632C10.4023 13.3086 10.0274 12.937 9.54936 12.6236C8.80125 12.1332 8.37861 11.8279 7.65244 11.3494C6.81323 10.7964 7.35725 10.4924 7.83552 9.99567C7.96069 9.86567 10.1355 7.88746 10.1776 7.70801C10.1829 7.68557 10.1878 7.60191 10.1381 7.55773C10.0884 7.51356 10.015 7.52866 9.9621 7.54068C9.88707 7.55771 8.69195 8.34763 6.37675 9.91046C6.03752 10.1434 5.73026 10.2569 5.45496 10.2509C5.15147 10.2444 4.56767 10.0793 4.13367 9.93827C3.60136 9.76524 3.17829 9.67376 3.21513 9.37989C3.23432 9.22683 3.4451 9.07029 3.84747 8.91028Z"
                        fill="white"
                      />
                    </svg>
                  </Link>
                </li>
                <li>
                  <Switch />
                </li>
              </ul>
            </ul>
          </div>
        </div>
      </div>
      {callbackModal && (
        <ModalQuestions onClose={() => setCallbackModal(false)} />
      )}
    </footer>
  );
}
